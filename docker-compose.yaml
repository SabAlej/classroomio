version: '3.8'
services:
  classroomio-com:
    build: 
      context: ./
      dockerfile: ./apps/classroomio-com/Dockerfile
    command: pnpm dev
    volumes:
      - ./apps/classroomio-com:/usr/src/classroomio-com
      - ./packages:/usr/src/packages
    ports:
      - 3001:3000
    depends_on:
      - supabase
    environment:
      - SUPABASE_URL=http://supabase:8000
      - SUPABASE_SERVICE_ROLE_KEY=service_role_key
      - SUPABASE_ANON_KEY=anon_key

  dashboard:
    build: 
      context: ./ 
      dockerfile: ./apps/dashboard/Dockerfile
    command: pnpm start
    volumes:
      - ./apps/dashboard:/usr/src/dashboard
      - ./packages:/usr/src/packages
    ports:
      - 3002:3000
    depends_on:
      - supabase
    environment:
      - SUPABASE_URL=http://supabase:8000
      - SUPABASE_SERVICE_ROLE_KEY=service_role_key
      - SUPABASE_ANON_KEY=anon_key

  supabase:
    image: bitnami/supabase-postgres
    ports:
      - 54321:54321
      - 54323:54323
      - 54324:54324
    environment:
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_USER=postgres
      - POSTGRES_DB=postgres
      - DB_HOST=supabase
      - DB_PORT=5432
      - SUPABASE_JWT_SECRET=your-jwt-secret
      - AUTO_APPLY_MIGRATIONS=true
